<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover" />
  <title>MR Studio Mobile (3-Part)</title>

  <style>
    :root{
      --bg-primary:#f2f2f7; --bg-secondary:#ffffff;
      --text-primary:#1c1c1e; --text-secondary:#8e8e93;
      --shadow:rgba(0,0,0,.15);
    }
    body.dark-mode{
      --bg-primary:#1c1c1e; --bg-secondary:#2c2c2e;
      --text-primary:#ffffff; --text-secondary:#98989d;
      --shadow:rgba(0,0,0,.5);
    }
    body{
      margin:0; background:var(--bg-primary); overflow:hidden;
      font-family:-apple-system,"SF Pro Text",sans-serif;
      -webkit-user-select:none; user-select:none; touch-action:none;
      color:var(--text-primary);
    }

    #overlay{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      background:rgba(255,255,255,.95); backdrop-filter:blur(25px);
      z-index:999;
      transition:opacity .35s ease;
    }
    body.dark-mode #overlay{ background:rgba(28,28,30,.95); }
    h1{ margin:0 0 10px 0; font-size:30px; font-weight:900; letter-spacing:-1px; }
    p{ margin:0 0 26px 0; color:var(--text-secondary); font-weight:700; text-align:center; max-width:86%; }

    #theme-selector{ display:flex; gap:12px; margin-bottom:28px; }
    .theme-option{
      padding:12px 18px; border-radius:16px;
      border:2px solid #e5e5ea; background:#fff;
      font-weight:900; cursor:pointer; display:flex; gap:8px; align-items:center;
      transition:.2s;
    }
    .theme-option.active{ background:#FF9500; border-color:#FF9500; color:#fff; }
    .theme-option:active{ transform:scale(.97); }

    button.start-btn{
      padding:16px 46px; border:none; border-radius:40px;
      background:#FF9500; color:#fff; font-size:18px; font-weight:900;
      box-shadow:0 10px 26px rgba(255,149,0,.35);
      cursor:pointer; transition:.2s;
    }
    button.start-btn:active{ transform:scale(.97); }

    #render-bar, #camera-bar{
      position:absolute; left:50%; transform:translateX(-50%);
      display:flex; gap:6px;
      padding:4px; border-radius:14px;
      background:rgba(255,255,255,.9); backdrop-filter:blur(18px);
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      z-index:120; max-width:92%;
      overflow-x:auto; -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
    }
    #render-bar{ top:calc(50px + env(safe-area-inset-top)); }
    #camera-bar{ top:calc(108px + env(safe-area-inset-top)); }
    #render-bar::-webkit-scrollbar, #camera-bar::-webkit-scrollbar{ display:none; }

    .render-opt, .cam-opt{
      border:none; background:transparent;
      padding:8px 14px; border-radius:10px;
      font-size:12px; font-weight:900; color:#999; cursor:pointer;
      white-space:nowrap; transition:.2s;
    }
    .render-opt.active, .cam-opt.active{
      background:#fff; color:#000; box-shadow:0 3px 10px rgba(0,0,0,.12);
    }
    .icon-btn{
      width:44px; height:36px; border-radius:10px; border:none;
      background:rgba(235,235,240,.6);
      font-size:18px; font-weight:900; cursor:pointer;
      transition:.2s;
    }
    body.dark-mode .icon-btn{ background:rgba(255,255,255,.12); color:#fff; }
    .icon-btn:active{ transform:scale(.97); }
    .icon-btn[disabled]{ opacity:.35; cursor:default; transform:none; }

    #exit-manipulation{
      position:absolute;
      top:calc(50px + env(safe-area-inset-top));
      right:calc(18px + env(safe-area-inset-right));
      width:44px; height:44px; border-radius:22px;
      background:rgba(255,59,48,.95);
      color:#fff; border:none; font-size:22px; font-weight:900;
      display:none; align-items:center; justify-content:center;
      box-shadow:0 10px 26px rgba(255,59,48,.35);
      z-index:160; cursor:pointer;
    }
    #exit-manipulation.visible{ display:flex; }
    #exit-manipulation:active{ transform:scale(.92); }

    #space-toggle{
      position:absolute;
      top:calc(168px + env(safe-area-inset-top));
      left:50%; transform:translateX(-50%);
      padding:10px 16px;
      border-radius:20px;
      background:rgba(255,255,255,.92);
      border:2px solid #FF9500;
      font-size:13px; font-weight:900;
      display:none; align-items:center; gap:7px;
      box-shadow:0 10px 26px rgba(255,149,0,.22);
      z-index:160; cursor:pointer;
    }
    #space-toggle.visible{ display:flex; }
    #space-toggle.local{
      background:rgba(52,199,89,.95);
      border-color:#34C759;
      color:#fff;
    }

    #edit-values-btn{
      position:absolute;
      width:56px; height:56px;
      background:rgba(255,149,0,.95);
      border:3px solid #fff;
      border-radius:28px;
      color:#fff; font-size:26px; font-weight:900;
      box-shadow:0 14px 34px rgba(255,149,0,.4);
      display:none; align-items:center; justify-content:center;
      z-index:200; cursor:pointer;
    }
    #edit-values-btn.visible{ display:flex; }
    #edit-values-btn:active{ transform:scale(.92); }

    #toolbar-container{
      position:absolute;
      bottom:calc(35px + env(safe-area-inset-bottom));
      left:0; right:0;
      display:flex; justify-content:center;
      pointer-events:none; z-index:140;
    }
    #toolbar{
      pointer-events:auto;
      display:flex; gap:12px; padding:12px 16px;
      background:rgba(255,255,255,.9); backdrop-filter:blur(26px);
      border-radius:28px;
      box-shadow:0 18px 46px rgba(0,0,0,.16);
      max-width:94%;
      overflow-x:auto; -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
      border:1px solid rgba(255,255,255,.45);
    }
    #toolbar::-webkit-scrollbar{ display:none; }
    .tool-btn{
      width:56px; height:56px; border-radius:18px; border:none;
      background:rgba(235,235,240,.62);
      font-size:26px; font-weight:900;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      cursor:pointer; transition:.2s; color:#1c1c1e; flex-shrink:0;
    }
    body.dark-mode .tool-btn{ background:rgba(255,255,255,.12); color:#fff; }
    .tool-btn.active{ background:#FF9500; color:#fff; box-shadow:0 10px 22px rgba(255,149,0,.24); }
    .tool-btn:active{ transform:scale(.97); }
    .label{ font-size:9px; margin-top:3px; font-weight:900; opacity:.7; }
    .divider{ width:1px; background:rgba(0,0,0,.12); margin:0 4px; }

    /* Subtoolbar (thin carousel) */
    #subtoolbar-container{
      position:absolute;
      bottom:calc(112px + env(safe-area-inset-bottom));
      left:0; right:0;
      display:flex; justify-content:center;
      pointer-events:none; z-index:150;
    }
    #subtoolbar{
      pointer-events:auto;
      display:none; gap:10px; padding:8px 12px;
      background:rgba(255,255,255,.86); backdrop-filter:blur(22px);
      border-radius:22px;
      box-shadow:0 14px 34px rgba(0,0,0,.14);
      max-width:92%;
      overflow-x:auto; -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
      border:1px solid rgba(255,255,255,.35);
    }
    body.dark-mode #subtoolbar{ background:rgba(44,44,46,.86); border-color:rgba(255,255,255,.12); }
    #subtoolbar.visible{ display:flex; }
    #subtoolbar::-webkit-scrollbar{ display:none; }

    .sub-btn{
      height:38px; padding:0 14px; border-radius:14px; border:none;
      background:rgba(235,235,240,.62);
      font-weight:900; font-size:12px;
      cursor:pointer; display:flex; align-items:center; gap:8px;
      transition:.2s; flex-shrink:0;
    }
    body.dark-mode .sub-btn{ background:rgba(255,255,255,.12); color:#fff; }
    .sub-btn.active{
      background:rgba(0,122,255,.92);
      color:#fff;
      box-shadow:0 12px 26px rgba(0,122,255,.18);
    }

    /* Special button for Explode */
    .sub-btn.explode.active{
      background:rgba(255,59,48,.92);
      box-shadow:0 12px 26px rgba(255,59,48,.16);
    }
    .pill{
      width:18px; height:18px; border-radius:6px;
      background:rgba(0,0,0,.08);
      display:inline-flex; align-items:center; justify-content:center;
      font-size:12px; font-weight:900;
    }

    /* measurement */
    #measurement-line{ position:absolute; pointer-events:none; opacity:0; transition:opacity .15s; z-index:155; }
    #measurement-line.visible{ opacity:1; }
    #distance-label{
      position:absolute;
      background:rgba(0,0,0,.9); color:#fff;
      padding:8px 14px; border-radius:16px;
      font-family:'SF Mono','Monaco',monospace;
      font-weight:900; font-size:14px;
      opacity:0; transition:opacity .15s;
      z-index:170; pointer-events:none;
    }
    #distance-label.visible{ opacity:1; }

    /* confirm mini */
    #confirm-dialog{
      position:absolute;
      bottom:calc(150px + env(safe-area-inset-bottom));
      left:50%; transform:translateX(-50%);
      display:none; gap:12px; align-items:center;
      padding:10px; border-radius:22px;
      background:rgba(255,255,255,.96); backdrop-filter:blur(20px);
      box-shadow:0 20px 60px rgba(0,0,0,.24);
      z-index:210;
    }
    body.dark-mode #confirm-dialog{ background:rgba(44,44,46,.96); }
    #confirm-dialog.visible{ display:flex; }
    .mini-btn{
      width:56px; height:56px; border-radius:18px; border:none;
      font-size:26px; font-weight:900;
      color:#fff; cursor:pointer; transition:.15s;
    }
    .mini-btn:active{ transform:scale(.95); }
    .mini-btn.cancel{ background:rgba(255,59,48,.95); }
    .mini-btn.ok{ background:rgba(52,199,89,.95); }

    /* axis dialog */
    #axis-input-dialog{
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      display:none; z-index:260;
      min-width:340px;
      padding:26px; border-radius:24px;
      background:rgba(255,255,255,.98); backdrop-filter:blur(20px);
      box-shadow:0 22px 70px rgba(0,0,0,.3);
    }
    body.dark-mode #axis-input-dialog{ background:rgba(44,44,46,.98); color:#fff; }
    #axis-input-dialog.visible{ display:block; }
    #axis-input-dialog h3{ margin:0 0 8px 0; font-weight:900; font-size:20px; text-align:center; }
    #axis-input-dialog .axis-name{ margin:0 0 18px 0; text-align:center; color:var(--text-secondary); font-weight:800; font-size:13px; }
    .input-row{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .input-label{
      width:30px; height:30px; border-radius:8px;
      display:flex; align-items:center; justify-content:center;
      color:#fff; font-weight:900;
    }
    .input-label.x{ background:#FF3B30; }
    .input-label.y{ background:#34C759; }
    .input-label.z{ background:#007AFF; }
    .axis-input-field{
      flex:1;
      padding:16px; font-size:22px; font-weight:900; text-align:center;
      border-radius:12px; border:2px solid #e5e5ea;
      font-family:'SF Mono','Monaco',monospace;
      outline:none;
    }
    body.dark-mode .axis-input-field{ background:rgba(28,28,30,.6); border-color:rgba(255,255,255,.18); color:#fff; }
    .axis-input-field:focus{ border-color:#FF9500; }
    .buttons{ display:flex; gap:12px; margin-top:16px; }
    .btn-apply, .btn-cancel{
      flex:1; border:none; border-radius:14px;
      padding:14px; font-weight:900; font-size:16px; color:#fff;
      cursor:pointer;
    }
    .btn-apply{ background:#34C759; }
    .btn-cancel{ background:#FF3B30; }
    .btn-apply:active, .btn-cancel:active{ transform:scale(.97); }

    /* edit camera panel (right side) */
    #edit-cam-panel{
      position:absolute;
      right:calc(14px + env(safe-area-inset-right));
      top:50%;
      transform:translateY(-50%);
      display:none; flex-direction:column; gap:12px;
      z-index:220;
    }
    #edit-cam-panel.visible{ display:flex; }
    .camlock-btn{
      width:56px; height:56px; border-radius:18px;
      border:2px solid rgba(255,255,255,.6);
      background:rgba(255,255,255,.9);
      backdrop-filter:blur(16px);
      box-shadow:0 14px 32px rgba(0,0,0,.14);
      font-size:24px; font-weight:900;
      cursor:pointer; transition:.15s;
    }
    body.dark-mode .camlock-btn{ background:rgba(44,44,46,.9); border-color:rgba(255,255,255,.12); color:#fff; }
    .camlock-btn.active{
      background:rgba(0,122,255,.92);
      color:#fff;
      border-color:rgba(0,122,255,.35);
      box-shadow:0 14px 34px rgba(0,122,255,.22);
    }
    .camlock-btn:active{ transform:scale(.95); }
  </style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>

  <div id="overlay">
    <h1>MR STUDIO</h1>
    <p>Mobile 3D Touch Modeling ‚Ä¢ V√©rtices (Merge/Explode) ‚Ä¢ Undo/Redo</p>

    <div id="theme-selector">
      <div class="theme-option active" id="theme-light">‚òÄÔ∏è <span>Modo Claro</span></div>
      <div class="theme-option" id="theme-dark">üåô <span>Modo Oscuro</span></div>
    </div>

    <button class="start-btn" id="btn-start">Comenzar</button>
  </div>

  <div id="render-bar">
    <button class="render-opt active" data-render="flat">Plano</button>
    <button class="render-opt" data-render="clay">Clay</button>
    <button class="render-opt" data-render="tech">Tech</button>
  </div>

  <div id="camera-bar">
    <button class="icon-btn" id="btn-undo" title="Undo" disabled>‚ü≤</button>
    <button class="icon-btn" id="btn-redo" title="Redo" disabled>‚ü≥</button>

    <button class="cam-opt" data-cam="fitall">Fit All</button>
    <button class="cam-opt" data-cam="focus">Focus</button>
    <button class="cam-opt" data-cam="iso">Iso</button>
    <button class="cam-opt" data-cam="top">Top</button>
    <button class="cam-opt" data-cam="front">Front</button>
    <button class="cam-opt" data-cam="right">Right</button>
  </div>

  <button id="exit-manipulation">‚úï</button>

  <button id="space-toggle">
    <span id="space-icon">üåç</span>
    <span id="space-text">Global</span>
  </button>

  <button id="edit-values-btn">‚úèÔ∏è</button>

  <div id="edit-cam-panel">
    <button class="camlock-btn" id="btn-cam-zoom" title="Zoom">üîç</button>
    <button class="camlock-btn" id="btn-cam-orbit" title="√ìrbita">üåÄ</button>
  </div>

  <svg id="measurement-line" width="100%" height="100%" style="position:absolute; inset:0;">
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
        <polygon points="0 0, 10 5, 0 10" fill="#FF9500" />
      </marker>
    </defs>
    <line id="measure-line" x1="0" y1="0" x2="0" y2="0"
          stroke="#FF9500" stroke-width="3" stroke-dasharray="8,4"
          marker-end="url(#arrowhead)" />
    <circle id="origin-dot" cx="0" cy="0" r="6" fill="#34C759" />
  </svg>

  <div id="distance-label">0.00 m</div>

  <div id="confirm-dialog">
    <button class="mini-btn cancel" id="btn-cancel">‚úï</button>
    <button class="mini-btn ok" id="btn-ok">‚úì</button>
  </div>

  <div id="axis-input-dialog">
    <h3 id="axis-title">Posici√≥n Exacta</h3>
    <div class="axis-name" id="axis-subtitle">Ingresa X, Y, Z</div>

    <div class="input-row">
      <div class="input-label x">X</div>
      <input type="number" id="input-x" class="axis-input-field" step="0.1" value="0.00"/>
    </div>
    <div class="input-row">
      <div class="input-label y">Y</div>
      <input type="number" id="input-y" class="axis-input-field" step="0.1" value="0.00"/>
    </div>
    <div class="input-row">
      <div class="input-label z">Z</div>
      <input type="number" id="input-z" class="axis-input-field" step="0.1" value="0.00"/>
    </div>

    <div class="buttons">
      <button class="btn-apply" id="btn-apply">‚úì Aplicar</button>
      <button class="btn-cancel" id="btn-close">‚úï Cancelar</button>
    </div>
  </div>

  <!-- Subtoolbar -->
  <div id="subtoolbar-container">
    <div id="subtoolbar">
      <button class="sub-btn" id="sub-verts"><span class="pill">V</span>V√©rtices</button>
      <button class="sub-btn" id="sub-edges"><span class="pill">E</span>Bordes</button>
      <button class="sub-btn" id="sub-faces"><span class="pill">F</span>Caras</button>
      <button class="sub-btn explode" id="sub-explode"><span class="pill">üí•</span>Explode</button>
      <button class="sub-btn" id="sub-clear"><span class="pill">‚úï</span>Limpiar</button>
    </div>
  </div>

  <!-- Main toolbar -->
  <div id="toolbar-container">
    <div id="toolbar">
      <button class="tool-btn" data-spawn="box">üì¶<span class="label">Cubo</span></button>
      <button class="tool-btn" data-spawn="sphere">‚ö™<span class="label">Esfera</span></button>
      <button class="tool-btn" data-spawn="cylinder">ü•´<span class="label">Cil</span></button>
      <button class="tool-btn" data-spawn="cone">üî∫<span class="label">Cono</span></button>
      <button class="tool-btn" data-spawn="torus">üç©<span class="label">Toro</span></button>
      <button class="tool-btn" data-spawn="plane">üü¶<span class="label">Plano</span></button>
      <div class="divider"></div>

      <button class="tool-btn active" id="btn-move" data-mode="translate">‚ÜîÔ∏è<span class="label">Mover</span></button>
      <button class="tool-btn" id="btn-rot" data-mode="rotate">üîÑ<span class="label">Rotar</span></button>
      <button class="tool-btn" id="btn-scale" data-mode="scale">üîç<span class="label">Escala</span></button>
      <button class="tool-btn" id="btn-select" data-mode="select">‚úÖ<span class="label">Selec</span></button>

      <div class="divider"></div>
      <button class="tool-btn" id="btn-delete">üóëÔ∏è<span class="label">Borrar</span></button>
      <button class="tool-btn" id="btn-color">üé≤<span class="label">Color</span></button>
    </div>
  </div>

  <script type="module" src="./editor-core.js"></script>
</body>
</html>
